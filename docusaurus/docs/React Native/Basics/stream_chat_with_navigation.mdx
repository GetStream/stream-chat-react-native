---
id: stream_chat_with_navigation
sidebar_position: 3
title: Stream Chat with Navigation
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

<!-- TODO: Change to new docs for links -->
Stream Chat for React Native provides many features out of the box that require positioning on the screen in a certain manor to result in the desired UI.
The `AttachmentPicker`, `ImageGallery`, and `MessageOverlay`, all need to be rendered in front of other components to have the desired effect.
All of these elements are controlled by the `OverlayProvider`, when used together with navigation considerations need to be taken in how these will appear.

The guidance provided makes the assumption you are using [React Navigation](https://reactnavigation.org/) in your app in conjunction with [`createStackNavigator`](https://reactnavigation.org/docs/stack-navigator/).

:::note

**If you are using another navigation solution, or utilizing [`createNativeStackNavigator`](https://reactnavigation.org/docs/native-stack-navigator/), other considerations will need to be taken depending on your navigation arrangement.**
<br />

<code>createNativeStackNavigator</code> uses the native APIs <code>UINavigationController</code> on iOS and <code>Fragment</code> on Android.
The <code>OverlayProvider</code> needs to exist in a view that can render content in front of the chat screen.
Therefore using a <code>fullScreenModal</code> with <code>createNativeStackNavigator</code>, which uses <code>UIModalPresentationFullScreen</code> on iOS and <code>modal</code> on Android, to render your chat screen will leave the <code>OverlayProvider</code> rendered behind the chat.
If you are having issues we suggest you get in touch with support and we can find a solution to your specific navigation arrangement.

:::

## Navigation Container

The [`NavigationContainer`](https://reactnavigation.org/docs/navigation-container/) manages the apps state in React Navigation.
Nested navigators and screens all exist within the container.
To ensure the `OverlayProvider` can render content above all of these screens, headers, tab-bars, etc. the `OverlayProvider` must be rendered around them.

<!-- TODO: Change to new docs for links -->
[As noted in Hello Stream Chat](hello_stream_chat#chat) the `Chat` component can either surround the entire application or be rendered locally on a screen.
You can choose whatever suits your needs best, theming, connection handling, and translations are all handled out of the box in the `Chat` component; and this may be a consideration in where in the app you want this component to be rendered.

:::note

Having it higher in the *stack* helps to ensure it is not unmounted at times when a connection is present.
If `Chat` is unmounted with a connection present you may have to implement some connection handling functions yourself to ensure you reconnect when the app is, for instance, reopened from the background.
The WebSocket connection closes on it's own approximately 15 seconds after the app is backgrounded.
Not handling the connection on [`appState`](https://reactnative.dev/docs/appstate) changes will also effect <!-- TODO: Change to new docs for links -->[how Stream Chat handles Push Notifications](https://getstream.io/chat/docs/react-native/push_introduction/?language=javascript).

:::

<Tabs
  defaultValue='app'
  values={[
    { label: 'App', value: 'app' },
    { label: 'Screen', value: 'screen' },
  ]}
>
<TabItem value='app'>

  ```tsx
  import React from 'react';
  import { NavigationContainer } from '@react-navigation/native';
  import { createStackNavigator } from '@react-navigation/stack';
  import { Chat, OverlayProvider } from 'stream-chat-react-native';

  const client = StreamChat.getInstance('api_key');
  const Stack = createStackNavigator<{ home: undefined }>();

  export const App = () => 
    <NavigationContainer>
      <OverlayProvider>
        <Chat client={client}>
          <Stack.Navigator>
            <Stack.Screen component={() => {/** App components */})} name='home' />
          </Stack.Navigator>
        </Chat>
      </OverlayProvider>
    </NavigationContainer>;
  ```

</TabItem>
<TabItem value='screen'>

  ```tsx
  import { StreamChat } from 'stream-chat'; 
  import { Chat } from 'stream-chat-react-native';

  const client = StreamChat.getInstance('api_key');

  export const Screen = () =>
    <Chat client={client}>
      {/** App components */}
    </Chat>;
  ```

  ```tsx
  import React from 'react';
  import { NavigationContainer } from '@react-navigation/native';
  import { createStackNavigator } from '@react-navigation/stack';
  import { OverlayProvider } from 'stream-chat-react-native';
  import { Screen } from './Screen'

  const Stack = createStackNavigator<{ home: undefined }>();

  export const App = () => 
    <NavigationContainer>
      <OverlayProvider>
        <Stack.Navigator>
          <Stack.Screen component={Screen} name='home' />
        </Stack.Navigator>
      </OverlayProvider>
    </NavigationContainer>;
  ```

</TabItem>
</Tabs>

## Keyboard

## Attachment Picker

The `AttachmentPicker` is a keyboard-esk view that allows a user to attach photos and files.
Part of the construction of the `AttachmentPicker` is a bottom-sheet provided by the `OverlayProvider`.
This bottom-sheet provides a grid of images in a scrollable list that can be lifted up to make selecting images easier.
The placement of the `AttachmentPicker` is dependant on two values, the `bottomInset` and the `topInset`.

### topInset

`topInset` is used to determine how high the scrollable bottom-sheet can go when opened.
`topInset` can be set to 0 to cover the entire screen, or the [top safe area inset](https://reactnavigation.org/docs/handling-safe-area/#use-the-hook-for-more-control) if desired.
The most common choice when using React Navigation is to get the header height using the `useHeaderHeight` hook from `@react-navigation/stack` and set the top inset to the given height for a nice visual result where the picker open to the header.

:::caution

**The bottom sheet will not render without `topInset` set.**
<br />

The current implementation of the scrollable bottom-sheet in which the image picker resides does not re-evaluate heights after the `topInset` is set; therefore set the `topInset` value only once.

:::

```tsx
const headerHeight = useHeaderHeight();
const { setTopInset, topInset } = useAttachmentPickerContext();

useEffect(() => {
  if (!topInset) {
    setTopInset(headerHeight);
  }
}, [headerHeight]);
```

:::note

`topInset` can be set via props on the `OverlayProvider`, or set via the `setTopInset` function provided by the `useAttachmentPickerContext` hook.

:::

### bottomInset

`bottomInset` is used to adjust the height of the `AttachmentPicker` menu to align properly with the bottom-sheet when open.
This is the height between the bottom of the <!-- TODO: Change to new docs for links -->`MessageInput` container and the bottom of the screen.
If you are displaying the chat screen without a tab-bar it is most likely the bottom inset is the [bottom safe area inset](https://reactnavigation.org/docs/handling-safe-area/#use-the-hook-for-more-control).
If you are using a bottom tab-bar you can utilize the `useBottomTabBarHeight` hook from `@react-navigation/bottom-tabs` to get the appropriate height to use.

```tsx
import React from 'react';
import { NavigationContainer } from '@react-navigation/native';
import { createStackNavigator } from '@react-navigation/stack';
import { useSafeAreaInsets } from 'react-native-safe-area-context';
import { Chat, OverlayProvider } from 'stream-chat-react-native';

const client = StreamChat.getInstance('api_key');
const Stack = createStackNavigator<{ home: undefined }>();

export const Nav = () => {
  const { bottom } = useSafeAreaInsets();
  
  return (
    <NavigationContainer>
      <OverlayProvider bottomInset={bottom}>
        <Chat client={client}>
          <Stack.Navigator>
            <Stack.Screen component={() => {/** App components */})} name='home' />
          </Stack.Navigator>
        </Chat>
      </OverlayProvider>
    </NavigationContainer>
  );
};
```

```tsx
import React from 'react';
import { SafeAreaProvider } from 'react-native-safe-area-context';
import { Nav } from './Nav';

export const App = () =>
  <SafeAreaProvider>
    <Nav />
  </SafeAreaProvider>;
```

:::note

`bottomInset` can be set via props on the `OverlayProvider`, or set via the `setBottomInset` function provided by the `useAttachmentPickerContext` hook.

:::

### Resetting Selected Items

## Image Gallery